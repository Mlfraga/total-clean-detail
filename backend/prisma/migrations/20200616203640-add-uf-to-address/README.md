# Migration `20200616203640-add-uf-to-address`

This migration has been generated by Matheus Fraga at 6/16/2020, 8:36:40 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Role" AS ENUM ('SELLER', 'MANAGER', 'ADMIN');

CREATE TABLE "public"."User" (
"email" text  NOT NULL ,"firstLogin" boolean  NOT NULL DEFAULT true,"id" SERIAL,"password" text  NOT NULL ,"role" "Role" NOT NULL DEFAULT E'SELLER',"username" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Profile" (
"companyId" integer   ,"enabled" boolean  NOT NULL DEFAULT true,"id" SERIAL,"name" text  NOT NULL ,"telephone" text  NOT NULL ,"unitId" integer   ,"userId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Company" (
"cnpj" text  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,"telephone" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Unit" (
"companyId" integer  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Service" (
"enabled" boolean  NOT NULL DEFAULT true,"id" SERIAL,"name" text  NOT NULL ,"price" Decimal(65,30)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."CompanyService" (
"companyId" integer  NOT NULL ,"id" SERIAL,"price" Decimal(65,30)  NOT NULL ,"serviceId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Person" (
"cpf" text  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,"telephone" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Address" (
"city" text  NOT NULL ,"houseNumber" text  NOT NULL ,"id" SERIAL,"neighborhood" text  NOT NULL ,"personId" integer  NOT NULL ,"street" text  NOT NULL ,"uf" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Car" (
"car" text  NOT NULL ,"carPlate" text  NOT NULL ,"id" SERIAL,"personId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Sale" (
"carId" integer  NOT NULL ,"companyPrice" Decimal(65,30)  NOT NULL ,"costPrice" Decimal(65,30)  NOT NULL ,"deliveryDate" timestamp(3)  NOT NULL ,"done" boolean  NOT NULL DEFAULT false,"id" SERIAL,"personId" integer  NOT NULL ,"requestDate" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"sellerId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."ServiceSale" (
"id" SERIAL,"saleId" integer  NOT NULL ,"serviceId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.username" ON "public"."User"("username")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Profile.userId" ON "public"."Profile"("userId")

CREATE UNIQUE INDEX "Company.name" ON "public"."Company"("name")

CREATE UNIQUE INDEX "Company.cnpj" ON "public"."Company"("cnpj")

CREATE UNIQUE INDEX "Service.name" ON "public"."Service"("name")

CREATE UNIQUE INDEX "Person.cpf" ON "public"."Person"("cpf")

CREATE UNIQUE INDEX "Address_personId" ON "public"."Address"("personId")

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("unitId")REFERENCES "public"."Unit"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Unit" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."CompanyService" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."CompanyService" ADD FOREIGN KEY ("serviceId")REFERENCES "public"."Service"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Address" ADD FOREIGN KEY ("personId")REFERENCES "public"."Person"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Car" ADD FOREIGN KEY ("personId")REFERENCES "public"."Person"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Sale" ADD FOREIGN KEY ("sellerId")REFERENCES "public"."Profile"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Sale" ADD FOREIGN KEY ("personId")REFERENCES "public"."Person"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Sale" ADD FOREIGN KEY ("carId")REFERENCES "public"."Car"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ServiceSale" ADD FOREIGN KEY ("saleId")REFERENCES "public"."Sale"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ServiceSale" ADD FOREIGN KEY ("serviceId")REFERENCES "public"."Service"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200616203640-add-uf-to-address
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,131 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum Role {
+  SELLER
+  MANAGER
+  ADMIN
+}
+
+model User {
+  id         Int     @id @default(autoincrement())
+  username   String  @unique
+  email      String  @unique
+  password   String
+  role       Role    @default(SELLER)
+  firstLogin Boolean @default(true)
+  profile    Profile
+}
+
+model Profile {
+  id        Int      @id @default(autoincrement())
+  name      String
+  telephone String
+  enabled   Boolean  @default(true)
+  userId    Int      @unique
+  companyId Int?
+  unitId    Int?
+  user      User     @relation(fields: [userId], references: [id])
+  company   Company? @relation(fields: [companyId], references: [id])
+  unit      Unit?    @relation(fields: [unitId], references: [id])
+  sale      Sale[]
+}
+
+model Company {
+  id             Int              @id @default(autoincrement())
+  name           String           @unique
+  telephone      String
+  cnpj           String           @unique
+  units          Unit[]
+  Profile        Profile[]
+  sompanyService CompanyService[]
+}
+
+model Unit {
+  id        Int       @id @default(autoincrement())
+  name      String
+  companyId Int
+  company   Company   @relation(fields: [companyId], references: [id])
+  Profile   Profile[]
+}
+
+model Service {
+  id             Int              @id @default(autoincrement())
+  name           String           @unique
+  price          Float
+  enabled        Boolean          @default(true)
+  CompanyService CompanyService[]
+  serviceSale    ServiceSale[]
+}
+
+model CompanyService {
+  id        Int     @id @default(autoincrement())
+  price     Float
+  companyId Int
+  serviceId Int
+  company   Company @relation(fields: [companyId], references: [id])
+  service   Service @relation(fields: [serviceId], references: [id])
+}
+
+model Person {
+  id        Int      @id @default(autoincrement())
+  cpf       String   @unique
+  name      String
+  telephone String
+  address   Address?
+  cars      Car[]
+  sales     Sale[]
+}
+
+model Address {
+  id           Int    @id @default(autoincrement())
+  street       String
+  houseNumber  String
+  neighborhood String
+  city         String
+  uf           String
+  personId     Int
+  person       Person @relation(fields: [personId], references: [id])
+}
+
+model Car {
+  id       Int    @id @default(autoincrement())
+  car      String
+  carPlate String
+  personId Int
+  person   Person @relation(fields: [personId], references: [id])
+  sale     Sale[]
+}
+
+model Sale {
+  id           Int           @id @default(autoincrement())
+  requestDate  DateTime      @default(now())
+  deliveryDate DateTime
+  done         Boolean       @default(false)
+  companyPrice Float
+  costPrice    Float
+  sellerId     Int
+  personId     Int
+  carId        Int
+  seller       Profile       @relation(fields: [sellerId], references: [id])
+  person       Person        @relation(fields: [personId], references: [id])
+  car          Car           @relation(fields: [carId], references: [id])
+  serviceSale  ServiceSale[]
+}
+
+model ServiceSale {
+  id        Int     @id @default(autoincrement())
+  saleId    Int
+  serviceId Int
+  sale      Sale    @relation(fields: [saleId], references: [id])
+  service   Service @relation(fields: [serviceId], references: [id])
+}
```


